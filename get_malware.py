import requests
import os
from bs4 import BeautifulSoup

# MalwareBazaar API with query intel
def download_malware_samples():
    res = requests.post("https://bazaar.abuse.ch/ajax/", data={"query":"tag","tag":"elf"})

    # For all malware samples, download them
    soup = BeautifulSoup(res.text, 'html.parser')
    for link in soup.find_all('a'):
        a = link.get('href')
        if "sample" in a:
            print(a.split("\/")[2])
            b = a.split("\/")[2]
            os.system(f'wget --post-data "query=get_file&sha256_hash={b}" https://mb-api.abuse.ch/api/v1/ -O samples/queue/{b}.zip')

if __name__ == "__main__":
    download_malware_samples()